https://console.aws.amazon.com/cloudformation/home?region=us-west-2#/stacks/new?stackName=AWS-Cloudera-Infrastructure&templateURL=https:%2F%2Fs3.amazonaws.com%2Fquickstart-reference%2Fcloudera%2Fhadoop%2Flatest%2Ftemplates%2FTemplate1-AWS-Infrastructure-Cloudera.template

use aws to launch stack (cloud formation template)
scp aws key to launcher
ssh to launcher box
Go to director client path
 add key path to .conf file

Go to director server path
start director
nohup ./bin/cloudera-director-server &

Go to director client path
bootstrap the cluster nodes and cm
./bin/cloudera-director bootstrap-remote aws.simple.conf --lp.remote.hostAndPort=127.0.0.1:7189 --lp.remote.username=admin --lp.remote.password=admin

Connecting to aws

browser apps require ssh tunnel
director
ssh -i /Users/rim/Keys/richard-im-aws.pem -L 7189:localhost:7189 ec2-user@launcher-eip

cm & nav ports
ssh -i /Users/rim/Keys/richard-im-aws.pem -L 7180:cm-private-ip:7180 -L 7187:cm-private-ip:7187 ec2-user@launcher-eip

After 'uninstall'
clean up uninstalls in the cluster
hdfs nn dirs need to be clean so remove old remnants of:
/data0/dfs/nn/*
/data1/dfs/nn/*

dn clean up
/data0/dfs/dn/*
/data1/dfs/dn/*

hbase zk issue since zk starts up dir wasnt cleaned out
on hbase master:
$ hbase zkcli
$ rmr /hbase

TLS? and SSL? UGH

//on nodes disable requirement for tty, though ssh with -t flag may prevent need for this
sudo visudo
#Defaults requiretty

kerberos
https://github.com/hunggpham/krb-bootstrap
install kdc
https://wiki.cloudera.com/display/FieldTechServices/Enabling+Kerberos+using+Cloudera+Manager

sudo yum install krb5-*

change realm in /etc/krb5.conf
in lib defaults
  udp_preference_limit = 1
Edit /var/kerberos/krb5kdc/kadm5.acl on the kdc to match your realm.

sudo kdb5_util create -s
sudo rm /etc/krb5.keytab
sudo service krb5kdc start
sudo service kadmin start

Copy krb5.conf to every node in the cluster, including the CM server.

test krb
sudo kadmin.local
kadmin: addprinc test
kadmin: listprincs
kinit -V test

install jce using cm upgrade wizard for agents

create cm user princ
sudo kadmn.local
kadmin:  addprinc -pw <Password> cloudera-scm/admin@YOUR-LOCAL-REALM.COM

in /var/kerberos/krb5kdc/kdc.conf match realm and add
max_renewable_life = 7d 0h 0m 0s
  default_principal_flags = +renewable, +forwardable

WIZARD
may require restart kdc
may require generate credentials upon first failure.

kadmin:  addprinc hdfs@YOUR-LOCAL-REALM.COM
kinit hdfs@YOURLREAL.COM

create user accounts
useradd -u <number greater than 1000> uname (script to do multiples on all nodes)
kadmin:  addprinc uname@YOUR-LOCAL-REALM.COM
kinit uname@YOURLREAL.COM

create hdfs home folder (need to be hdfs super user)
$ hadoop fs -mkdir /user/rim
$ hadoop fs -chown joe /user/rim




